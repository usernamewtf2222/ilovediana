<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>–°–µ–∫—Ä–µ—Ç–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫ üíù</title>
<style>
  :root{
    --bg1:#ffdde1; --bg2:#ee9ca7; --ink:#3d0036;
    --rose:#ff5d8f; --pink:#ff7eb3; --card:#ffffffee; --gold:#ffcf66;
  }
  *{box-sizing:border-box}
  body{
    margin:0; min-height:100vh; display:grid; place-items:center;
    background: radial-gradient(1200px 800px at 50% -10%, #ffdbe9, transparent), linear-gradient(135deg,var(--bg2),var(--bg1));
    font-family: "Inter", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    color:var(--ink); overflow:hidden;
  }

  .stage{
    width:min(900px,94vw);
    background:var(--card); border:1px solid #ffd7e6;
    border-radius:28px; padding:24px; text-align:center;
    box-shadow:0 22px 65px rgba(255, 82, 140, .28);
    position:relative;
  }
  h1{margin:.2em 0 .4em; font-weight:900}
  p{margin:.2em 0 1.2em; opacity:.9}

  /* progress pill */
  .pill{
    display:inline-flex; gap:10px; align-items:center; padding:8px 14px;
    border:1px solid #ffd1e3; border-radius:999px; background:#fff; font-weight:700;
  }
  .pill .dot{width:10px; height:10px; border-radius:50%; background:linear-gradient(135deg,var(--rose),var(--pink)); box-shadow:0 0 0 3px #ffe3ef}
  .need{opacity:.8; font-weight:600}

  /* gift area */
  .gift-wrap{
    position:relative; height:380px; display:grid; place-items:center; margin-top:10px;
  }

  .gift{
    position:relative; width:220px; height:180px; cursor:pointer; user-select:none;
    transform:translateY(10px);
  }
  .box{
    position:absolute; inset:auto 0 0 0; height:130px; background:#fff;
    border:3px solid #ffb1ca; border-bottom-width:8px; border-radius:16px 16px 22px 22px;
    background-image: linear-gradient(90deg, transparent 46%, var(--rose) 46% 54%, transparent 54%),
                      repeating-linear-gradient(90deg, #ffe7ef 0 16px, #ffd6e6 16px 32px);
    box-shadow:0 18px 35px rgba(255, 83, 143, .25);
  }
  .ribbon-vert{
    position:absolute; inset:22px calc(50% - 8px) 0 calc(50% - 8px);
    background:linear-gradient(180deg,var(--rose),var(--pink)); border-radius:8px;
    filter:drop-shadow(0 4px 6px rgba(255,90,140,.35));
  }
  .lid{
    position:absolute; left:50%; top:0; transform:translateX(-50%);
    width:240px; height:62px; border-radius:14px 14px 10px 10px;
    background:#fff; border:3px solid #ffb1ca;
    background-image: linear-gradient(90deg, transparent 46%, var(--rose) 46% 54%, transparent 54%),
                      repeating-linear-gradient(90deg, #ffe7ef 0 16px, #ffd6e6 16px 32px);
    transform-origin: 50% 100%;
    transition: transform .6s cubic-bezier(.2,.8,.2,1), box-shadow .6s;
    z-index:2;
  }
  .bow{
    position:absolute; top:-16px; left:50%; transform:translateX(-50%);
    width:90px; height:36px; display:flex; justify-content:space-between;
  }
  .loop, .loop::after{
    content:""; display:block; width:36px; height:36px; border-radius:999px 999px 6px 999px;
    background: radial-gradient(circle at 30% 30%, #ffc7d9, #ff7eb3);
    box-shadow:inset 0 -3px 6px rgba(0,0,0,.08);
    transform:rotate(45deg);
  }
  .loop.right{ transform:scaleX(-1) rotate(45deg)}
  .knot{
    position:absolute; top:5px; left:50%; transform:translateX(-50%);
    width:22px; height:22px; border-radius:50%; background:linear-gradient(135deg,var(--rose),var(--pink));
    box-shadow:0 6px 16px rgba(255,60,120,.3);
  }

  /* click sparkle */
  .spark{
    position:absolute; font-size:18px; opacity:.9; pointer-events:none;
    animation: rise .8s ease-out forwards;
  }
  @keyframes rise{
    to{ transform:translateY(-40px); opacity:0 }
  }

  /* hearts confetti */
  .burst{ position:absolute; inset:0; pointer-events:none; overflow:visible }
  .heart{
    position:absolute; font-size:22px; opacity:.9; transform:translate(-50%,-50%);
    animation: pop 900ms ease-out forwards;
  }
  @keyframes pop{
    0%{ transform:translate(-50%,-50%) scale(.6); opacity:0 }
    60%{ opacity:1 }
    100%{ transform:translate(var(--dx), var(--dy)) scale(1); opacity:0 }
  }

  /* photo appear */
  .photo{
    position:absolute; width:min(520px,86vw); max-height:70vh; object-fit:cover;
    border-radius:20px; border:6px solid #fff; box-shadow:0 30px 80px rgba(255, 60, 120, .35);
    left:50%; top:56%; transform:translate(-50%, -50%) scale(.7) rotate(-2deg);
    opacity:0; z-index:5;
  }
  .photo.show{
    animation: flyIn 950ms cubic-bezier(.16,.99,.29,1.01) forwards, glow 2.4s ease-out 900ms;
  }
  @keyframes flyIn{
    0%{opacity:0; transform:translate(-50%, 20%) scale(.7) rotate(-6deg)}
    60%{opacity:1}
    100%{opacity:1; transform:translate(-50%, -50%) scale(1) rotate(0deg)}
  }
  @keyframes glow{
    0%{ box-shadow:0 0 0 0 rgba(255,120,160,.0)}
    50%{ box-shadow:0 0 0 18px rgba(255,120,160,.25)}
    100%{ box-shadow:0 30px 80px rgba(255, 60, 120, .35)}
  }

  /* open state */
  .gift.open .lid{
    transform:translateX(-50%) rotateX(72deg) translateY(-6px);
    box-shadow:0 18px 26px rgba(255, 60, 120, .28);
  }
  .gift.jiggle{ animation:jiggle .45s ease-in-out }
  @keyframes jiggle{
    15%,85%{ transform:translateY(10px) rotate(-1deg)}
    35%,65%{ transform:translateY(10px) rotate(1.2deg)}
    50%{ transform:translateY(10px) rotate(-1.6deg)}
  }

  /* CTA */
  .cta{
    margin-top:8px; font-weight:800; letter-spacing:.2px; color:#ab1a5f;
  }
  .tiny{ font-size:12px; opacity:.8 }

  /* back button */
  .back{
    position:absolute; left:16px; top:16px;
    text-decoration:none; font-weight:800; color:#cc116a; background:#fff;
    padding:10px 12px; border-radius:12px; border:1px solid #ffd1e3;
  }

  /* —á—Ç–æ–±—ã —Ñ–æ—Ç–æ –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–æ –∫–ª–∏–∫–∏ –¥–æ –º–æ–º–µ–Ω—Ç–∞ –ø–æ–∫–∞–∑–∞ */
.photo{ pointer-events: none; z-index: 1; }

/* –∫–æ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ç–æ ‚Äî —Å–Ω–æ–≤–∞ —Ä–∞–∑—Ä–µ—à–∞–µ–º —Å–æ–±—ã—Ç–∏—è –∏ –ø–æ–¥–Ω–∏–º–∞–µ–º –Ω–∞–¥ –≤—Å–µ–º */
.photo.show{ pointer-events: auto; z-index: 20; }

/* –Ω–∞ –≤—Å—è–∫–∏–π: –¥–µ—Ä–∂–∏–º –∫–æ—Ä–æ–±–∫—É –ø–æ–≤–µ—Ä—Ö –¥–æ –æ—Ç–∫—Ä—ã—Ç–∏—è */
.gift{ z-index: 10; }

/* –ø—Ä–∏—è—Ç–Ω–µ–µ –Ω–∞ –º–æ–±–∏–ª–∫–∞—Ö: —É–±–∏—Ä–∞–µ–º –∑–∞–¥–µ—Ä–∂–∫—É –∏ –ø–æ–¥—Å–≤–µ—Ç–∫—É —Ç–∞–ø–∞ */
.gift{ touch-action: manipulation; -webkit-tap-highlight-color: transparent; }
</style>
</head>
<body>
  <a class="back" href="success.html">‚Üê –Ω–∞–∑–∞–¥</a>

  <div class="stage">
    <h1>–Ω–∞–∂–∏–º–∞–π –Ω–∞ –ø–æ–¥–∞—Ä–æ–∫ üíù</h1>
    <p>–ü–†–Ø–ú –ë–´–°–¢–†–û –û–ß–ï–ù–¨</p>

    <div class="pill" id="pill">
      <span class="dot"></span>
      <span id="progressText">0%</span>
      <span class="need">‚Ä¢ –Ω—É–∂–Ω–æ –∫–ª–∏–∫–æ–≤: <span id="needLeft">20</span></span>
    </div>

    <div class="gift-wrap">
      <img class="photo" id="photo" src="kotik1.jpg" alt="–ù–∞—à–µ —Ñ–æ—Ç–æ" />
      <div class="gift" id="gift" aria-label="–ü–æ–¥–∞—Ä–æ–∫">
        <div class="lid">
          <div class="bow">
            <div class="loop"></div>
            <div class="loop right"></div>
            <div class="knot"></div>
          </div>
        </div>
        <div class="box"></div>
        <div class="ribbon-vert"></div>
      </div>
      <canvas class="burst" id="burst" width="900" height="380"></canvas>
    </div>

    <div class="cta" id="cta">–¥–∞–≤–∞–π –¥–∞–≤–∞–π –¥–∞–≤–∞–π üíó</div>
    <div class="tiny"></div>
  </div>

<script>
  const REQUIRED_CLICKS = 20; // –ø–æ–º–µ–Ω—è–π —á–∏—Å–ª–æ, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ "–±–æ–ª—å—à–µ/–º–µ–Ω—å—à–µ —Ä–∞–∑"
  let clicks = 0;
  let opened = false;

  const gift = document.getElementById('gift');
  const pill = document.getElementById('pill');
  const progressText = document.getElementById('progressText');
  const needLeft = document.getElementById('needLeft');
  const cta = document.getElementById('cta');
  const photo = document.getElementById('photo');

  // Canvas for heart burst
  const burstCanvas = document.getElementById('burst');
  const ctx = burstCanvas.getContext('2d');
  const hearts = [];

  function resizeCanvas(){
    const rect = burstCanvas.parentElement.getBoundingClientRect();
    burstCanvas.width = rect.width;
    burstCanvas.height = rect.height;
  }
  resizeCanvas();
  window.addEventListener('resize', resizeCanvas);

  function spawnClickSpark(x,y){
    const s = document.createElement('div');
    s.className = 'spark';
    s.textContent = Math.random()<.7 ? 'üíñ' : '‚ú®';
    s.style.left = x+'px';
    s.style.top = y+'px';
    document.body.appendChild(s);
    setTimeout(()=>s.remove(), 800);
  }

  function spawnHeartsBurst(cx, cy, count=20){
    const rect = burstCanvas.getBoundingClientRect();
    const x = cx - rect.left;
    const y = cy - rect.top;

    for(let i=0;i<count;i++){
      hearts.push({
        x, y,
        vx:(Math.random()*2-1)*2.2,
        vy:(Math.random()*-1.5 - .8)*2.2,
        life: 60 + Math.random()*30,
        age: 0,
        emoji: Math.random()<.5 ? 'üíó' : '‚ù§',
        size: 16 + Math.random()*12,
      });
    }
  }

  function draw(){
    ctx.clearRect(0,0,burstCanvas.width, burstCanvas.height);
    hearts.forEach(h=>{
      h.age++;
      h.vy += 0.04; // gravity
      h.x += h.vx;
      h.y += h.vy;

      const alpha = Math.max(0, 1 - h.age/h.life);
      ctx.save();
      ctx.globalAlpha = alpha;
      ctx.font = `${h.size}px system-ui, emoji`;
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText(h.emoji, h.x, h.y);
      ctx.restore();
    });
    for(let i=hearts.length-1;i>=0;i--){
      if(hearts[i].age >= hearts[i].life) hearts.splice(i,1);
    }
    requestAnimationFrame(draw);
  }
  draw();

  function updateProgress(){
    const pct = Math.min(100, Math.round((clicks / REQUIRED_CLICKS)*100));
    progressText.textContent = pct + '%';
    needLeft.textContent = Math.max(0, REQUIRED_CLICKS - clicks);
  }

  function openGift(){
    if(opened) return;
    opened = true;
    gift.classList.add('open');
    cta.textContent = '–û—Ç–∫—Ä—ã—Ç–æ! üíû';
    spawnHeartsBurst(burstCanvas.width/2, burstCanvas.height/2, 36);

    // Show photo after lid animation
    setTimeout(()=>{
      photo.classList.add('show');
      // bonus hearts
      for(let i=0;i<3;i++){
        setTimeout(()=>spawnHeartsBurst(burstCanvas.width/2, burstCanvas.height*0.45, 26), i*160);
      }
    }, 650);
    
  }

  gift.addEventListener('click', (e)=>{
    if(opened) return;
    clicks++;
    gift.classList.remove('jiggle'); void gift.offsetWidth; gift.classList.add('jiggle');

    updateProgress();

    // small effects per click
    spawnClickSpark(e.clientX, e.clientY);
    spawnHeartsBurst(e.clientX, e.clientY, 10);

    if(clicks >= REQUIRED_CLICKS){
      openGift();
    }
  });

  // Keyboard support (for fun)
  window.addEventListener('keydown', (e)=>{
    if(e.code === 'Space' || e.key === 'Enter'){
      const rect = gift.getBoundingClientRect();
      const cx = rect.left + rect.width/2;
      const cy = rect.top + rect.height/2;
      gift.click();
      spawnHeartsBurst(cx, cy, 12);
    }
  });
// –ü–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É –ø–æ—Å–ª–µ –ø–æ—è–≤–ª–µ–Ω–∏—è —Ñ–æ—Ç–æ
setTimeout(()=>{
  document.getElementById('nextBtn').style.display = 'inline-block';
}, 6000);

  // initial state
  updateProgress();
</script>
<a id="nextBtn" href="sky.html" style="
  display:none;
  position:absolute; bottom:40px; left:90%; transform:translateX(-50%);
  padding:14px 20px; border-radius:14px; font-weight:800;
  background:linear-gradient(135deg,#ff5d8f,#ff7eb3); color:white;
  text-decoration:none; box-shadow:0 12px 30px rgba(255, 60, 120, .35);
">—Ç–µ–ø–µ—Ä—å —Å—é–¥–∞</a>
</body>
</html>
